<!doctype html>
<html>

<head>
     
    <meta charset="UTF-8">
     
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
     <!-- Tailwind -->
     
    <script src="https://cdn.tailwindcss.com"></script>
     
     <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

</head>

<body>

    <form class="m-24">

        <div id="enemy" class="mt-2 flex justify-start px-6 py-10">

            <div class="text-center mr-24">
                <img id="enemy-image" src="" class="mx-auto h-64 w-64" />
            </div>
            <div class="float-right">
                <p id="enemy-hp1" class="text-xs leading-5 text-green-600 flex"></p>
                <p id="enemy-hp2" class="text-xs leading-5 text-green-600 flex"></p>
                <p id="enemy-hp3" class="text-xs leading-5 text-green-600 flex"></p>
                <p id="enemy-hp4" class="text-xs leading-5 text-green-600 flex"></p>
                <p id="enemy-hp5" class="text-xs leading-5 text-gray-800 flex hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-3 h-3">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                    </svg>
                </p>
                <p id="enemy-hpt" class="text-xs leading-5 text-gray-400"></p>
                <div class="mt-4 text-sm leading-6 text-gray-400">
                    <div
                        class="relative cursor-pointer rounded-md bg-white font-semibold text-gray-800 focus-within:outline-none focus-within:ring-2 focus-within:ring-gray-800 focus-within:ring-offset-2 hover:text-gray-700">
                        <span id="enemy-packet" data-ecp=""></span>
                    </div>
                </div>
            </div>
        </div>

        <div id="player" class="-mt-32 flex justify-end px-6 py-10">
            <div class="text-right mt-32">
                <div class="text-sm leading-6 text-gray-400">
                    <div
                        class="relative cursor-pointer rounded-md bg-white font-semibold text-gray-400 focus-within:outline-none focus-within:ring-2 focus-within:ring-gray-400 focus-within:ring-offset-2 hover:text-gray-300">
                        <span id="player-packet" data-pcp=""></span>
                    </div>
                </div>
                <p id="player-hpt" class="mt-4 text-xs leading-5 text-gray-400"></p>

                <p id="player-hp5" class="text-xs leading-5 text-gray-800 flex float-right hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-3 h-3">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                    </svg>
                </p>
                <p id="player-hp1" class="text-xs leading-5 text-green-600 flex float-right"></p>
                <br />
                <p id="player-hp2" class="-mt-3 text-xs leading-5 text-green-600 flex float-right"></p>
                <br />
                <p id="player-hp3" class="-mt-6 text-xs leading-5 text-green-600 flex float-right"></p>
                <br />
                <p id="player-hp4" class="-mt-9 text-xs leading-5 text-green-600 flex float-right"></p>
            </div>
            <div class="text-center ml-24">
                <img id="player-image" src="" class="mx-auto h-64 w-64" />
            </div>
        </div>

        <a href="#" id="dialogue" data-dialogue="start">
            <div id="dialogue-container" class="mt-2 flex rounded-lg border border border-gray-900/25 px-6 py-10">

                <div class="mt-2 px-6 py-10">

                    <div class="text-center mr-24">

                        <p id="dialogue-text" class="text-lg leading-5 text-gray-600"></p>
                    </div>

                </div>

                <div class="mt-2 px-6 py-10">

                    <div class="text-center mr-24">

                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="float-right animate-bounce w-6 h-6">
                             
                            <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                        </svg>
                    </div>

                </div>
            </div>
        </a>

        <div id="options" class="hidden mt-2 flex rounded-lg border border border-gray-900/25 px-6 py-10">

            <div class="flex w-full mt-2 px-6">
                <div class="w-1/2">
                    <a href="#" id="fight" data-fight="selected fight">FIGHT</a>
                </div>
                <div class="w-1/2">ITEM</div>
                <div class="w-1/2">PACKETS</div>
                <div class="w-1/2">RUN</div>
            </div>

        </div>

        <div id="skills" class="hidden mt-2 flex rounded-lg border border border-gray-900/25 px-6 py-10">

            <div class="flex w-full mt-2 px-6">
                <div class="w-1/2">
                    <a href="#" id="skill-1" data-s1n="Tackle" data-s1sp="8">Tackzzle - 8</a>
                </div>
                <div class="w-1/2">
                    <a href="#" id="skill-2" data-s2n="Noodle Whip" data-s2sp="6">Noodle Whip - 6</a>
                </div>
                <div class="w-1/2">
                    <a href="#" id="skill-3" data-s3n="Chili Powder Blow" data-s3sp="4">Chili Powder Blow - 4</a>
                </div>
                <div class="w-1/2">
                    <a href="#" id="skill-4" data-s4n="Razor Plastic" data-s4sp="4">Razor Plastic - 4</a>
                </div>

            </div>

        </div>

    </form>

    <script>
        function getPacket(id) {
            const packets = initializePackets();
            console.log(" ---packets")
            console.log(packets)
            let packet = {};
            $.each(packets, function (key, value) {
                console.log(value);
                console.log(value.id);
                if (id == value.id) {
                    packet = value;
                }
            });
            console.log("value")
            console.log(packet)
            return packet;
        }

        function debuffChance(param) {
            let success = false;
            let chance = Math.random() * 100;
            if (chance < 40) { // 0-39 40%					
                success = true;
            }
            return success
        }

        function printHearts(type, hp) {
            // Default player				
            let row1 = "#player-hp1";
            let row2 = "#player-hp2";
            let row3 = "#player-hp3";
            let row4 = "#player-hp4";
            let row5 = "#player-hp5";
            if (type == "enemy") {
                row1 = "#enemy-hp1";
                row2 = "#enemy-hp2";
                row3 = "#enemy-hp3";
                row4 = "#enemy-hp4";
                row5 = "#enemy-hp5";
            } // Reset rows
            $(row1).html("");
            $(row2).html("");
            $(row3).html("");
            $(row4).html("");
            for (i = 1; i <= hp; i++) {
                if (i <= 25) {
                    $(row1).append('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>');
                } else if (i <= 50) {
                    $(row2).append('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>');
                } else if (i <= 75) {
                    $(row3).append('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>');
                } else if (i <= 100) {
                    $(row4).append('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>');
                }
            }
            if (hp < 1) {
                $(row5).removeClass("hidden");
            }
        }

        function changeDamagedHeartsColor(type, hp) {
            // Default player				
            let row1 = "#player-hp1";
            let row2 = "#player-hp2";
            let row3 = "#player-hp3";
            let row4 = "#player-hp4";
            if (type == "enemy") {
                row1 = "#enemy-hp1";
                row2 = "#enemy-hp2";
                row3 = "#enemy-hp3";
                row4 = "#enemy-hp4";
            }
            if (hp <= 25) {
                $(row1).addClass("text-red-600");
            }
        }

        function getSelectedPacket(type) {
            const searchParams = new URLSearchParams(window.location.search);
            let id = Math.random() * 5; // Random id								
            console.log(searchParams.has(type));
            if (searchParams.has(type)) {
                id = searchParams.get(type);
            }
            return id;
        }
        $(document).ready(function () { // Initialize packets in play

            // TODO: Debuffs have 40% to hit				
            let debuffHit = .4;
            let blind = .3; // Reduce to 30% chance to hit				
            let damageOverTime = Math.ceil(10 / 2); // Reduce HP per turn								
            // Enemy				
            let selectedEnemy = getSelectedPacket("enemy")
            let enemy = getPacket(selectedEnemy);
            // Loading HP				
            let enemyHp = enemy.hp;
            let currentEnemyHp = enemy.hp;
            // Populate UI with enemy data
            $("#enemy-image").attr("src", enemy.image);
            $("#enemy-hpt").html("HP " + currentEnemyHp + "/" + enemyHp);
            printHearts("enemy", currentEnemyHp);
            $("#enemy-packet").html(enemy.name);
            $("#enemy-packet").attr("data-ecp", enemy.name);
            $("#dialogue-text").html("A wild " + enemy.name + " appeared!");
            // Player
            let selectedPlayer = getSelectedPacket("player")
            let player = getPacket(selectedPlayer);
            console.log(player.skills[0])
            console.log("player.skill")
            // Loading HP
            let playerHp = player.hp;
            let currentPlayerHp = player.hp;
            // Populate UI with data
            $("#player-image").attr("src", player.image);
            $("#player-hpt").html("HP " + currentPlayerHp + "/" + playerHp);
            printHearts("player", currentPlayerHp);
            $("#player-packet").html(player.name);
            $("#player-packet").attr("data-pcp", player.name);

            // Skills				
            $("#skill-1").attr("data-s1n", player.skills[0].name);
            $("#skill-1").attr("data-s1sp", player.skills[0].sp);
            $("#skill-1").text(player.skills[0].name + " - " + player.skills[0].sp);
            $("#skill-2").attr("data-s1n", player.skills[1].name);
            $("#skill-2").attr("data-s1sp", player.skills[1].sp);
            $("#skill-2").text(player.skills[1].name + " - " + player.skills[1].sp);
            $("#skill-3").attr("data-s1n", player.skills[2].name);
            $("#skill-3").attr("data-s1sp", player.skills[2].sp);
            $("#skill-3").text(player.skills[2].name + " - " + player.skills[2].sp);
            $("#skill-4").attr("data-s1n", player.skills[3].name);
            $("#skill-4").attr("data-s1sp", player.skills[3].sp);
            $("#skill-4").text(player.skills[3].name + " - " + player.skills[3].sp);
            // Dialogue window actions
            $("#dialogue").on("click", function (e) {
                console.log("Your values are :" + $(this).data("dialogue"));
                // Start
                $("#dialogue").toggle().attr("data-dialogue", "battle");
                $("#options").toggle();
                // Player turn
                if ($(this).attr("data-fight") == "player") {
                    console.log("player turn");
                    $("#dialogue").hide();
                    $("#options").show();
                    $("#enemy").removeClass("animate-bounce");
                    $("#player").removeClass("animate-pulse");
                } // Remove animation on enemy
                if ($("#enemy").hasClass("animate-pulse")) {
                    $("#enemy").removeClass("animate-pulse");
                    $("#player").removeClass("animate-bounce");
                } // Enemy turn					
                if ($(this).attr("data-fight") == "enemy") {
                    console.log("enemy attack");
                    $("#options").hide();
                    $("#dialogue-text").text(enemy.name + " used " + player.skills[1].name + "!");
                    $("#dialogue").show();
                    $("#dialogue-container").addClass("bg-red-200");
                    $("#enemy").addClass("animate-bounce");
                    $("#player").addClass("animate-pulse");
                    // Enemy damage setup
                    let damage = player.skills[1].damage;
                    // Compute damage
                    currentPlayerHp = currentPlayerHp - damage;
                    // Player defeated
                    if (currentPlayerHp < 1) {
                        currentPlayerHp = 0;
                        console.log(currentPlayerHp);
                        console.log("player defeated");
                        $("#skills").hide().attr("data-fight", "close options battle over");
                        $("#dialogue").show().attr("data-fight", "over");
                        $("#dialogue-text").text(player + " has been defeated!");
                    } else {
                        // Setup next user turn							
                        $("#dialogue").show().attr("data-fight", "player");
                    }
                    $("#player-hpt").html("HP " + currentPlayerHp + "/" + playerHp);
                    // Refresh hearts/hp meter
                    printHearts("player", currentPlayerHp);
                    changeDamagedHeartsColor("player", currentPlayerHp);
                }
                // Battle over
                if ($(this).attr("data-fight") == "over") {
                    console.log("battle over");
                    $("#options").hide();
                    $("#dialogue-text").text("Game Over. Would you like to play again?");
                    $("#dialogue").attr("href", pathname.replace("battle", "index"));
                    $("#dialogue").show();
                }
            });

            $("#fight").on("click", function (e) {
                console.log("Fight clicked :" + $(this).data("fight"));
                $("#options").toggle().attr("data-fight", "selecting skill");
                $("#skills").toggle().attr("data-fight", "selecting skill window open");
            }); // TODO: Check turn on who attacks first. Now player goes first but take into account the speed stat later.
            // Activating skills in battle				
            $("#skill-1").on("click", function (e) {
                let damage = player.skills[0].damage;
                console.log("Skill 1 clicked name :" + $(this).attr("data-s1n"));
                console.log("Skill 1 clicked skill point :" + $(this).attr("data-s1sp"));
                $("#skills").toggle().attr("data-fight", "selecting skill");
                // Update dialogue
                $("#dialogue").toggle().attr("data-fight", "selecting skill");
                $("#dialogue-text").text($("#player-packet").text() + " used " + $(this).attr("data-s1n") + "!");
                // Deduct skill
                if ($(this).attr("data-s1sp") > 0) {
                    const updatedSkillPoint = $(this).attr("data-s1sp") - 1;
                    $("#skill-1").attr("data-s1sp", updatedSkillPoint).text($(this).attr("data-s1n") + " - " + updatedSkillPoint);
                    // Animate attack
                    $("#enemy").addClass("animate-pulse");
                    $("#player").addClass("animate-bounce");
                    if (updatedSkillPoint == 0) {
                        $("#skill-1").addClass("text-red-400").attr("id", "skill-1-disabled");
                    } // Compute damage
                    console.log("currentEnemyHp")
                    console.log(currentEnemyHp)
                    console.log(damage)
                    currentEnemyHp = currentEnemyHp - damage;
                    $("#enemy-hpt").html("HP " + currentEnemyHp + "/" + enemyHp);
                    // Refresh hearts/hp meter
                    printHearts("enemy", currentEnemyHp);
                    changeDamagedHeartsColor("enemy", currentEnemyHp);
                    // Setup enemy turn						
                    $("#dialogue").show().attr("data-fight", "enemy");
                    // Enemy defeated
                    if (currentEnemyHp < 1) {
                        currentEnemyHp = 0;
                        console.log(currentEnemyHp);
                        console.log("defeated");
                        $("#skills").hide().attr("data-fight", "close options battle over");
                        $("#dialogue").show().attr("data-fight", "over");
                        $("#dialogue-text").text($("#enemy-packet").text() + " has been defeated!");
                    }
                } else {
                    $("#dialogue-text").text("Unable to use " + $(this).attr("data-s1n") + ", not enough skill points!");
                }
            });
        })
    </script>

</body>

<script>
    function initializePackets() { // Hard coded.... Fetch from DB later
        // Damage multiplier
        const base = 1;
        const mid = 1.25;
        const high = 1.5;

        const packets = [{
            id: 1,
            name: "Pikachu",
            hp: 35,
            attack: 55,
            defense: 30,
            speed: 90,
            remarks: "Pikachu stats.",
            image: "assets/packets/pikachu.png",
            skills: [{
                name: "Tackle",
                damage: Math.ceil(10 * base),
                type: "attack",
                sp: "7"
            },
            {
                name: "Noodle Whip",
                damage: Math.ceil(10 * mid),
                type: "attack",
                sp: "6"
            },
            {
                name: "Chili Powder Blow",
                damage: 0,
                type: "debuff",
                sp: "4"
            },
            {
                name: "Razor Plastic",
                damage: Math.ceil(10 * high),
                type: "attack",
                sp: "3"
            }
            ]
        },
        {
            id: 2,
            name: "Charmander",
            hp: 39,
            attack: 52,
            defense: 43,
            speed: 65,
            remarks: "Charmander stats.",
            image: "assets/packets/charmander.png",
            skills: [{
                name: "Scratch",
                damage: Math.ceil(12 * base),
                type: "attack",
                sp: "9"
            },
            {
                name: "UTI",
                damage: Math.ceil(11 * mid),
                type: "attack",
                sp: "5"
            },
            {
                name: "Razor Plastic",
                damage: Math.ceil(12 * high),
                type: "attack",
                sp: "4"
            },
            {
                name: "Kidney Hit",
                damage: Math.ceil(13 * high),
                type: "attack",
                sp: "2"
            }
            ]
        },
        {
            id: 3,
            name: "Squirtle",
            hp: 44,
            attack: 48,
            defense: 65,
            speed: 43,
            remarks: "Squirtle stats.",
            image: "assets/packets/squirtle.png",
            skills: [{
                name: "Tackle",
                damage: Math.ceil(10 * base),
                type: "attack",
                sp: "13"
            },
            {
                name: "Water Gun",
                damage: Math.ceil(10 * mid),
                type: "attack",
                sp: "6"
            },
            {
                name: "Bubble",
                damage: Math.ceil(9 * high),
                type: "attack",
                sp: "4"
            },
            {
                name: "Hydro Pump",
                damage: Math.ceil(10 * high),
                type: "attack",
                sp: "3"
            }
            ]
        },
        {
            id: 4,
            name: "Bulbasaur",
            hp: 45,
            attack: 48,
            defense: 49,
            speed: 45,
            remarks: "Bulbasaur stats.",
            image: "assets/packets/bulbasaur.png",
            skills: [{
                name: "Tackle",
                damage: Math.ceil(10 * base),
                type: "attack",
                sp: "13"
            },
            {
                name: "Water Gun",
                damage: Math.ceil(10 * mid),
                type: "attack",
                sp: "6"
            },
            {
                name: "Bubble",
                damage: Math.ceil(9 * high),
                type: "attack",
                sp: "4"
            },
            {
                name: "Hydro Pump",
                damage: Math.ceil(10 * high),
                type: "attack",
                sp: "3"
            }
            ]
        },
        {
            id: 5,
            name: "Jigglypuff",
            hp: 115,
            attack: 45,
            defense: 20,
            speed: 20,
            remarks: "Jigglypuff stats.",
            image: "assets/packets/jigglypuff.png",
            skills: [{
                name: "Tackle",
                damage: Math.ceil(10 * base),
                type: "attack",
                sp: "13"
            },
            {
                name: "Water Gun",
                damage: Math.ceil(10 * mid),
                type: "attack",
                sp: "6"
            },
            {
                name: "Bubble",
                damage: Math.ceil(9 * high),
                type: "attack",
                sp: "4"
            },
            {
                name: "Hydro Pump",
                damage: Math.ceil(10 * high),
                type: "attack",
                sp: "3"
            }
            ]
        },
        {
            id: 6,
            name: "Meowth",
            hp: 40,
            attack: 45,
            defense: 35,
            speed: 90,
            remarks: "Meowth stats.",
            image: "assets/packets/meowth.png",
            skills: [{
                name: "Tackle",
                damage: Math.ceil(10 * base),
                type: "attack",
                sp: "13"
            },
            {
                name: "Water Gun",
                damage: Math.ceil(10 * mid),
                type: "attack",
                sp: "6"
            },
            {
                name: "Bubble",
                damage: Math.ceil(9 * high),
                type: "attack",
                sp: "4"
            },
            {
                name: "Hydro Pump",
                damage: Math.ceil(10 * high),
                type: "attack",
                sp: "3"
            }
            ]
        }, {
            id: 7,
            name: "Lucky Me",
            hp: 35,
            attack: 55,
            defense: 30,
            speed: 90,
            remarks: "High speed packet with low stats based on Pikachu.",
            image: "assets/packets/lakimichilimansi.png",
            skills: [{
                name: "Tackle",
                damage: Math.ceil(10 * base),
                type: "attack",
                sp: "7"
            },
            {
                name: "Noodle Whip",
                damage: Math.ceil(10 * mid),
                type: "attack",
                sp: "6"
            },
            {
                name: "Chili Powder Blow",
                damage: 0,
                type: "debuff",
                sp: "4"
            },
            {
                name: "Razor Plastic",
                damage: Math.ceil(10 * high),
                type: "attack",
                sp: "3"
            }
            ]
        },
        {
            id: 8,
            name: "Chippy",
            hp: 39,
            attack: 52,
            defense: 43,
            speed: 65,
            remarks: "Somewhat balanced stats with lower HP based on Charmander",
            image: "assets/packets/chippy.png",
            skills: [{
                name: "Scratch",
                damage: Math.ceil(12 * base),
                type: "attack",
                sp: "9"
            },
            {
                name: "UTI",
                damage: Math.ceil(11 * mid),
                type: "attack",
                sp: "5"
            },
            {
                name: "Razor Plastic",
                damage: Math.ceil(12 * high),
                type: "attack",
                sp: "4"
            },
            {
                name: "Kidney Hit",
                damage: Math.ceil(13 * high),
                type: "attack",
                sp: "2"
            }
            ]
        },
        ];

        return packets;
    } 
</script>

</html>